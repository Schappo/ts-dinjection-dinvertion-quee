name: Send message to Discord

on:
  pull_request:
    branches:
      - main

jobs:
  send_message:
    runs-on: ubuntu-latest
    steps:
      - name: Interpolate PR Message
        id: pr_message
        run: |
          echo "::set-output name=pr_message::[{\"color\":39423,\"title\":'\"${{ github.'event.pull_request.title }}\",\"url\":\"${{ github.event.pull_request.html_url }}\",\"author\":{\"name\":\"${{ github.event.pull_request.user.login}}\",\"icon_url\":\"${{ github.event.pull_request.user.avatar_url}}\",\"url\":\"${{ github.event.pull_request.user.html_url}}\"},\"description\":\"Branch: ${{ github.event.pull_request.base.ref }}\",\"timestamp\":\"${{ github.event.pull_request.updated_at }}\",\"footer\":{\"text\":\"${{ github.event.repository.full_name }}\",\"icon_url\":\"${{ github.event.repository.owner.avatar_url }}\"}}]"
          
      - name: Send message to Discord
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          DISCORD_USERNAME: 'W3bLocker'
          DISCORD_AVATAR: 'https://i.imgur.com/BPnQGGY.jpeg'
          DISCORD_EMBEDS: ${{ steps.pr_message.outputs.pr_message }}
